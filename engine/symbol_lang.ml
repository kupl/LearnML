open Lang
open Util

(*
  labeled exp
*)
type label = int

type labeled_pat = int * lpat
and lpat =
  | PCtor of id * labeled_pat list
  | Pats of labeled_pat list
  | PInt of int
  | PVar of id
  | PBool of bool
  | PList of labeled_pat list
  | PTuple of labeled_pat list
  | PUnder
  | PCons of labeled_pat list
  | PHole of int

type labeled_exp = int * lexp
and lexp =
  | Const of int
  | ADD of labeled_exp * labeled_exp
  | SUB of labeled_exp * labeled_exp
  | MUL of labeled_exp * labeled_exp
  | DIV of labeled_exp * labeled_exp
  | MOD of labeled_exp * labeled_exp
  | MINUS of labeled_exp
  | TRUE
  | FALSE
  | NOT of labeled_exp
  | OR of labeled_exp * labeled_exp
  | AND of labeled_exp * labeled_exp
  | LESS of labeled_exp * labeled_exp
  | LARGER of labeled_exp * labeled_exp
  | EQUAL of labeled_exp * labeled_exp
  | NOTEQ of labeled_exp * labeled_exp
  | LESSEQ of labeled_exp * labeled_exp
  | LARGEREQ of labeled_exp * labeled_exp
  | EVar of id
  | EApp of labeled_exp * labeled_exp
  | ELet of id * bool * arg list * typ * labeled_exp * labeled_exp
  | ECtor of id * labeled_exp list
  | EMatch of labeled_exp * l_bl list
  | IF of labeled_exp * labeled_exp * labeled_exp
  | AT of labeled_exp * labeled_exp
  | DOUBLECOLON of labeled_exp * labeled_exp
  | EList of labeled_exp list
  | ETuple of labeled_exp list
  | EFun of arg * labeled_exp
  | EFix  of id * arg * typ * labeled_exp
  | Hole of int
and l_bl = labeled_pat * labeled_exp

type labeled_decl = 
  | DData of id * ctor list                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  | DLet  of id * bool * arg list * typ * labeled_exp
type labeled_prog = labeled_decl list

(*
  symbolic variable
*)
type symbolic_variable = int

type symbolic_value = 
  | Int of int
  | Bool of bool
  | Symbol of int
  | List of symbolic_value list
  | Tuple of symbolic_value list
  | Ctor of id * symbolic_value list
  | Fun of id * labeled_exp
  | FunRec of id * id * labeled_exp
  | Add of symbolic_value * symbolic_value                                
  | Sub of symbolic_value * symbolic_value                                
  | Mul of symbolic_value * symbolic_value                                
  | Div of symbolic_value * symbolic_value                                
  | Mod of symbolic_value * symbolic_value                                
  | Minus of symbolic_value
  | Not of symbolic_value                                      
  | Or of symbolic_value * symbolic_value                                
  | And of symbolic_value * symbolic_value                               
  | Lt of symbolic_value * symbolic_value                             
  | Gt of symbolic_value * symbolic_value                            
  | Le of symbolic_value * symbolic_value                          
  | Ge of symbolic_value * symbolic_value                          
  | Eq of symbolic_value * symbolic_value                              
  | NEq of symbolic_value * symbolic_value                             
  | At of symbolic_value * symbolic_value
  | Cons of symbolic_value * symbolic_value
  | If of symbolic_value * symbolic_value * symbolic_value
  | Unknown

type symbol_set = symbolic_variable BatSet.t

(* variable to symbolic variable ex. x -> e1 *)
type symbolic_env = (id, symbolic_variable) BatMap.t
(* equation formula with variable and value ex. e1 = (e2+e3) *)
type formula = (symbolic_variable * symbolic_value) BatSet.t
(* type for symbolic variable ex. e1 -> int*)
type symbol_type_table = (symbolic_variable, typ) BatMap.t
(* symbol variable to label *)
type symbol2label = (symbolic_variable, int) BatMap.t
(* label to symbol variable set*)
type label2symbol = (int, symbol_set) BatMap.t

type rank = int 

(*
  labeled value
*)
type labeled_value =
  | VInt of int
  | VBool of bool
  | VList of labeled_value list
  | VTuple of labeled_value list
  | VCtor of id * labeled_value list
  | VFun  of id * labeled_exp * labeled_env * symbolic_env
  | VFunRec of id * id * labeled_exp * labeled_env * symbolic_env
  | VPFun of (labeled_value * labeled_value) list
  | VHole of int
and labeled_env = (id, labeled_value) BatMap.t

